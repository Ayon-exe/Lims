<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LIMS Dashboard</title>
    <link rel="icon" type="image/x-icon" href="./images/favicon.ico">
    <link rel="stylesheet" href="homepage.css">
    
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <a class="navbar-brand" href="#">LIMS</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item">
                    <a class="nav-link" href="#dashboard-section">Dashboard</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#samples-section">Samples</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#inventory-section">Inventory</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#profile-section">Profile</a>
                </li>
                <li class="nav-item">
                <a class="nav-link" id="logout-link" href="#">Logout</a>
            </li>
            </ul>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-content">
        <div id="dashboard-section" class="section active">
            <header id="home" class="header">
        <h1>Welcome to PharmaCo</h1>
        <p>Your Health, Our Priority</p>
        <p id="user-facility">Facility: </p>
    </header>

    <!-- Services Section -->
    <section id="services" class="services bg-light text-center">
        <div class="container">
            <h2>Select Testing Module</h2>
            <div class="row">
                <div class="col-md-4">
                    <img src="https://bio.unc.edu/wp-content/uploads/sites/353/2019/09/colourful-test-tubes.jpg" alt="Service 1"><a href="#inventory-section"> <!-- Replace with your image -->
                    <h3>Biochemical Tests</h3>
                </div>
                <div class="col-md-4">
                    <img src="https://portal.geochemcpslims.com/public/images/media/service/service-analytical.jpg" alt="Service 2"><a href="#inventory-section"> <!-- Replace with your image -->
                    <h3>Analytical Tests</h3>
                </div>
                <div class="col-md-4">
                    <img src="https://cultivatorphytolab.com/wp-content/uploads/2023/07/colonies-bacteria-gram-negative-bacilli-gram-negative-cocco-bacilli-1-1080x675.jpg" alt="Service 3"><a href="#inventory-section"> <!-- Replace with your image -->
                    <h3>Microbial Tests</h3>
                </div>
            </div>
        </div>
    </section>
    <!-- Footer -->
    <footer class="footer">
        <p>&copy; 2024 PharmaCo. All Rights Reserved.</p>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
        </div>
        
        <div id="samples-section" class="section">
            <h1>Sample Management</h1>
            <button id="add-sample" class="btn btn-primary">Add Sample</button>
            <table class="table">
                <thead>
                    <tr>
                        <th>Sample ID</th>
                        <th>Name</th>
                        <th>Status</th>
                        <th>Received Date</th>
                        <th>Processed Date</th>
                        <th>Notes</th>
                    </tr>
                </thead>
                <tbody id="sample-list">
                    <!-- Sample rows will be populated here -->
                </tbody>
            </table>
        </div>
        <div id="inventory-section" class="section">
            <h1>Inventory Management</h1>
            <button id="add-inventory" class="btn btn-primary">Add Inventory</button>
            <table class="table">
                <thead>
                    <tr>
                        <th>Item ID</th>
                        <th>Name</th>
                        <th>Quantity</th>
                        <th>Location</th>
                    </tr>
                </thead>
                <tbody id="inventory-list">
                    <!-- Inventory rows will be populated here -->
                </tbody>
            </table>
        </div>
        <!-- Profile Section -->
<div id="profile-section" class="section">
    <div class="container">
        <h1>User Profile</h1>
        <div id="profile-details">
            <p id="'profile-details'"></p>
        </div>
        <button id="edit-profile-btn" class="btn btn-primary">Edit Profile</button>
    </div>
</div>

    </div>

    <!-- Modal -->
    <div id="modal" class="modal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Item</h5>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="item-form">
                        <div class="form-group">
                            <label for="item-id">ID:</label>
                            <input type="text" class="form-control" id="item-id" required>
                        </div>
                        <div class="form-group">
                            <label for="item-name">Name:</label>
                            <input type="text" class="form-control" id="item-name" required>
                        </div>
                        <div class="form-group">
                            <label for="item-quantity">Quantity:</label>
                            <input type="number" class="form-control" id="item-quantity" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Add Item</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS and Firebase SDK -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js"></script>
    <script type="module">
        // Firebase configuration
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
        import { getAuth,onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";


        const firebaseConfig = {
            apiKey: "AIzaSyA-q0c86ThWaoePtmi9o0euID9Xu64WKsE",
            authDomain: "lims-48c6d.firebaseapp.com",
            databaseURL: "https://lims-48c6d-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "lims-48c6d",
            storageBucket: "lims-48c6d.appspot.com",
            messagingSenderId: "421362597347",
            appId: "1:421362597347:web:fd370a3e5540da7b5f34d6"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const auth = getAuth();

        document.addEventListener('DOMContentLoaded', () => {
            const sections = document.querySelectorAll('.section');

            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetSectionId = e.target.getAttribute('href').substring(1);
                    sections.forEach(section => {
                        if (section.id === targetSectionId) {
                            section.classList.add('active');
                        } else {
                            section.classList.remove('active');
                        }
                    });
                });
            });

            // Fetch data from Firebase
            fetchSamples();
            fetchInventory();
        });

        // Fetch samples from Firebase and display in table
        function fetchSamples() {
            const samplesRef = ref(database, 'samples/');
            onValue(samplesRef, (snapshot) => {
                const sampleList = document.getElementById('sample-list');
                sampleList.innerHTML = ''; // Clear the current list
                snapshot.forEach((childSnapshot) => {
                    const sample = childSnapshot.val();
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${sample.sampleId}</td>
                        <td>${sample.name}</td>
                        <td>${sample.status}</td>
                        <td>${sample.receivedDate}</td>
                        <td>${sample.processedDate}</td>
                        <td>${sample.notes}</td>

                    `;
                    sampleList.appendChild(row);
                });
            });
        }

        // Fetch inventory from Firebase and display in table
        function fetchInventory() {
            const inventoryRef = ref(database, 'inventory/');
            onValue(inventoryRef, (snapshot) => {
                const inventoryList = document.getElementById('inventory-list');
                inventoryList.innerHTML = ''; // Clear the current list
                snapshot.forEach((childSnapshot) => {
                    const item = childSnapshot.val();
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${item.itemId}</td>
                        <td>${item.name}</td>
                        <td>${item.quantity}</td>
                        <td>${item.location}</td>
                    `;
                    inventoryList.appendChild(row);
                });
            });
        }
// Function to fetch and display user profile information
// Function to fetch and display user profile information
function fetchUserProfile() {
    const profileDetails = document.getElementById('profile-details');
    const userFacility = document.getElementById('user-facility');
    const user = auth.currentUser;

    if (user) {
        // Fetch user data from Firebase
        const userRef = ref(database, 'users/' + user.uid);
        onValue(userRef, (snapshot) => {
            const userData = snapshot.val();
            if (userData) {
                profileDetails.innerHTML = `
                    <p><strong>Email:</strong> ${userData.email}</p>
                    <p><strong>Username:</strong> ${userData.username}</p>
                    <!-- Add more fields as needed -->
                `;
                // Display user's facility
                userFacility.textContent = `Facility: ${userData.facility}`;
            } else {
                profileDetails.innerHTML = `<p>No profile data found.</p>`;
                userFacility.textContent = `Facility: Not specified`;
            }
        });
    } else {
        profileDetails.innerHTML = `<p>User not logged in.</p>`;
        userFacility.textContent = `Facility: Not logged in`;
    }
}

// Call fetchUserProfile when the profile section is loaded or when user logs in
document.addEventListener('DOMContentLoaded', () => {
    fetchUserProfile();
});

// Example: Adding edit profile functionality (you can expand this as needed)
document.getElementById('edit-profile-btn').addEventListener('click', () => {
    const user = auth.currentUser;
    if (user) {
        // Redirect or show edit form based on your application flow
        console.log('Redirect to edit profile page or show edit form');
    } else {
        console.log('User not logged in, cannot edit profile.');
    }
});

        // Modal functionality
        document.getElementById('add-sample').addEventListener('click', () => openModal('sample'));
        document.getElementById('add-inventory').addEventListener('click', () => openModal('inventory'));

        function openModal(type) {
            const modal = document.getElementById('modal');
            modal.style.display = 'block';
            document.getElementById('item-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const itemId = document.getElementById('item-id').value;
                const itemName = document.getElementById('item-name').value;
                const itemQuantity = document.getElementById('item-quantity').value;
                const itemType = type === 'sample' ? 'samples' : 'inventory';
                const newItemRef = ref(database, `${itemType}/${itemId}`);
                set(newItemRef, {
                    itemId: itemId,
                    name: itemName,
                    quantity: itemQuantity,
                    location: '',
                    status: '',
                    receivedDate: '',
                    processedDate: '',
                    notes: ''
                }).then(() => {
                    console.log('Item added successfully');
                    modal.style.display = 'none';
                    fetchSamples(); // Refresh the table
                    fetchInventory(); // Refresh the table
                }).catch((error) => {
                    console.error('Error adding item: ', error);
                });
            });
        }
        document.getElementById('logout-link').addEventListener('click', function(event) {
        event.preventDefault();
        // Perform logout actions here (e.g., Firebase sign out)
        auth.signOut().then(() => {
            // Redirect to the logout page
            window.location.href = './index.html';
        }).catch((error) => {
            console.error('Error signing out: ', error);
        });
    });
    </script>
</body>
</html>
